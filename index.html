<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ê°œì¸ìš© ì‚¼ê°í˜• í€´ì¦ˆ (ì •í™• ê¸°í•˜/í•˜ì´ë¼ì´íŠ¸)</title>
  <style>
    :root{
      --bg:#0b1220; --card:#0f192e; --ink:#f0f4ff; --muted:#a8b7d8;
      --accent:#7aa2ff; --good:#2ee69a; --bad:#ff6b81; --warn:#ffd166;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial,sans-serif;background:radial-gradient(1200px 600px at 20% -10%,#16223c 0%,transparent 70%),linear-gradient(180deg,#0b1220 0%,#0d1424 100%);color:var(--ink)}
    .wrap{max-width:1100px;margin:28px auto;padding:0 16px}
    .card{background:linear-gradient(180deg,#0f182b 0%,#0d1526 100%);border:1px solid rgba(255,255,255,.08);box-shadow:0 12px 40px rgba(0,0,0,.45);border-radius:20px}
    header.card{padding:16px 18px;margin-bottom:18px;display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    header h1{font-size:20px;margin:0;letter-spacing:.2px}
    .chip{padding:8px 12px;border-radius:999px;background:rgba(122,162,255,.12);border:1px solid rgba(122,162,255,.25);color:var(--ink);font-weight:600}
    .row{display:grid;grid-template-columns:1fr 440px;gap:16px}
    @media (max-width:980px){.row{grid-template-columns:1fr}}
    .pane{padding:18px}
    .pane h2{margin:0 0 10px 0;font-size:18px;color:var(--ink)}
    .sub{color:var(--muted);font-size:14px;margin-top:2px}
    button{background:var(--accent);color:#06112b;border:none;border-radius:14px;padding:12px 16px;font-weight:800;cursor:pointer;transition:.2s transform, .2s opacity, .2s box-shadow;box-shadow:0 6px 16px rgba(122,162,255,.25)}
    button[disabled]{opacity:.45;cursor:not-allowed;box-shadow:none}
    button:active{transform:translateY(1px)}
    .ghost{background:transparent;color:var(--ink);border:1px solid rgba(255,255,255,.18);box-shadow:none}
    canvas{background:#0a1120;border:1px solid rgba(255,255,255,.08);border-radius:16px;width:100%;height:400px}
    .grid{display:grid;grid-template-columns:1fr;gap:10px;margin-top:12px}
    .opt{position:relative;padding:14px 16px;border:1px solid rgba(255,255,255,.14);border-radius:14px;background:linear-gradient(180deg,#0f192e,#0e182c);display:flex;align-items:center;gap:12px;min-height:54px;cursor:pointer;user-select:none;transition:.2s border-color,.2s background,.2s box-shadow}
    .opt:hover{border-color:rgba(122,162,255,.6)}
    .opt.selected{border-color:var(--accent);background:linear-gradient(180deg,rgba(122,162,255,.18),rgba(122,162,255,.10));box-shadow:0 8px 22px rgba(122,162,255,.25) inset}
    .opt.disabled{opacity:.6;pointer-events:none;filter:grayscale(.2)}
    .opt input{position:absolute;inset:0;opacity:0;pointer-events:none}
    .muted{color:var(--muted)}
    .mono{font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace}
    .stat{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .pill{border:1px solid rgba(255,255,255,.14);background:rgba(255,255,255,.06);color:var(--ink);padding:8px 10px;border-radius:999px;font-size:13px;font-weight:600}
    .notice{padding:12px 14px;border:1px dashed rgba(255,255,255,.28);border-radius:12px;background:rgba(255,255,255,.06);color:var(--muted);font-size:14px}
    .split{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .right{text-align:right}
    .footer{margin-top:10px;font-size:12px;color:var(--muted)}
    .hr{height:1px;background:linear-gradient(90deg,transparent,rgba(255,255,255,.16),transparent);margin:12px 0}
  </style>
</head>
<body>
  <div class="wrap">
    <header class="card">
      <h1>ê°œì¸ìš© ì‚¼ê°í˜• í€´ì¦ˆ</h1>
      <div class="stat">
        <span class="pill">ì§„í–‰: <span id="progress" class="mono">0/15</span></span>
        <span class="pill">ë§íŒ ìˆ˜: <span id="correctCnt" class="mono">0</span></span>
        <span class="pill">ê²½ê³¼ ì‹œê°„: <span id="timer" class="mono">00:00.00</span></span>
        <button id="btnStart">ì‹œì‘(15ë¬¸ì œ)</button>
        <button id="btnReset" class="ghost" disabled>ë‹¤ì‹œ ì‹œì‘</button>
      </div>
    </header>

    <div class="row">
      <!-- ë¬¸ì œ íŒ¨ë„ -->
      <section class="card pane">
        <h2>ë¬¸ì œ</h2>
        <div class="sub">ì‚¼ê°í˜•ì´ ë¬´ì‘ìœ„ë¡œ ìƒì„±ë˜ë©°, <b>ë³€ì˜ ê¸¸ì´(ì •ìˆ˜, cm)</b>ë§Œ í‘œì‹œë©ë‹ˆë‹¤. ì‹¤ì œ ê¸¸ì´ ë¹„ìœ¨ê³¼ ê°ë„ë¥¼ ê·¸ëŒ€ë¡œ ë°˜ì˜í•´ ê·¸ë¦½ë‹ˆë‹¤.</div>
        <div class="hr"></div>
        <canvas id="triCanvas" width="740" height="420"></canvas>
      </section>

      <!-- ì„ íƒ íŒ¨ë„ -->
      <section class="card pane">
        <h2>ì •ë‹µ ì„ íƒ</h2>
        <div class="sub">ì•„ë˜ì—ì„œ <b>ë³€ ë¶„ë¥˜ 1ê°œ + ê° ë¶„ë¥˜ 1ê°œ</b>ë¥¼ ê³¨ë¼ <b>ì œì¶œ</b>í•˜ì„¸ìš”. (ë°•ìŠ¤ ì•„ë¬´ ê³³ì´ë‚˜ í´ë¦­)</div>
        <div class="hr"></div>
        <div class="grid" id="sideGroup">
          <label class="opt" data-group="side" data-value="scalene">ì„¸ ë³€ì˜ ê¸¸ì´ê°€ ëª¨ë‘ ë‹¤ë¥¸ ì‚¼ê°í˜•<input type="radio" name="side" value="scalene"></label>
          <label class="opt" data-group="side" data-value="isosceles">ì´ë“±ë³€ì‚¼ê°í˜•<input type="radio" name="side" value="isosceles"></label>
          <label class="opt" data-group="side" data-value="equilateral">ì •ì‚¼ê°í˜•<input type="radio" name="side" value="equilateral"></label>
        </div>
        <div class="grid" id="angleGroup" style="margin-top:6px">
          <label class="opt" data-group="angle" data-value="acute">ì˜ˆê°ì‚¼ê°í˜•<input type="radio" name="angle" value="acute"></label>
          <label class="opt" data-group="angle" data-value="right">ì§ê°ì‚¼ê°í˜•<input type="radio" name="angle" value="right"></label>
          <label class="opt" data-group="angle" data-value="obtuse">ë‘”ê°ì‚¼ê°í˜•<input type="radio" name="angle" value="obtuse"></label>
        </div>
        <div class="split" style="margin-top:12px">
          <div>
            <div id="feedback" class="notice">ì‹œì‘ ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.</div>
          </div>
          <div class="right">
            <button id="btnSubmit" disabled>ì œì¶œ</button>
          </div>
        </div>
        <div class="footer">â€» ì˜¤ë‹µ ì‹œ <b>3ì´ˆê°„</b> ì„ íƒì´ ì ê¹ë‹ˆë‹¤. ë‹¤ìŒ ë¬¸ì œë¡œ ë„˜ì–´ê°€ë©´ ì„ íƒì€ ìë™ ì´ˆê¸°í™”ë©ë‹ˆë‹¤.</div>
      </section>
    </div>
  </div>

  <script>
    // ===== ì„¤ì • =====
    const TOTAL_QUESTIONS = 15;
    const BANNED_MIN = 75; // (deg) non-right ì—ì„œ ê¸ˆì§€ êµ¬ê°„
    const BANNED_MAX = 105;

    // ===== ì—˜ë¦¬ë¨¼íŠ¸ =====
    const $ = s => document.querySelector(s);
    const canvas = $('#triCanvas');
    const ctx = canvas.getContext('2d');
    const progressEl = $('#progress');
    const correctCntEl = $('#correctCnt');
    const timerEl = $('#timer');
    const btnStart = $('#btnStart');
    const btnReset = $('#btnReset');
    const btnSubmit = $('#btnSubmit');
    const feedback = $('#feedback');

    // ì¹´ë“œ(ì˜µì…˜) DOM
    const cardEls = [...document.querySelectorAll('.opt')];

    // ===== ìƒíƒœ =====
    let started = false;
    let qIndex = 0; // 0..14
    let correctCnt = 0;
    let timerId = null; let startTime = 0;
    let current = null; // {sides:[a,b,c], sideType, angleType}
    let locked = false;

    // ===== ë„ìš°ë¯¸ =====
    const randInt = (mn,mx)=> Math.floor(Math.random()*(mx-mn+1))+mn;
    const nearly = (x,y,eps=1e-9)=> Math.abs(x-y) <= eps;

    function resetCards(){
      document.querySelectorAll('.opt.selected').forEach(el=> el.classList.remove('selected'));
      document.querySelectorAll('.opt input').forEach(i=>{ i.checked=false; });
      btnSubmit.disabled = true;
    }
    function getSelections(){
      const s = document.querySelector('input[name="side"]:checked');
      const a = document.querySelector('input[name="angle"]:checked');
      return s && a ? {side:s.value, angle:a.value} : null;
    }
    function updateTopBar(){
      progressEl.textContent = `${Math.min(qIndex, TOTAL_QUESTIONS)}/${TOTAL_QUESTIONS}`;
      correctCntEl.textContent = String(correctCnt);
    }
    function fmtTime(ms){
      const t = Math.max(0, ms|0);
      const m = String(Math.floor(t/60000)).padStart(2,'0');
      const s = String(Math.floor((t%60000)/1000)).padStart(2,'0');
      const cs = String(Math.floor((t%1000)/10)).padStart(2,'0');
      return `${m}:${s}.${cs}`;
    }
    function startTimer(){
      startTime = Date.now();
      timerId = setInterval(()=>{ timerEl.textContent = fmtTime(Date.now()-startTime); }, 31);
    }
    function stopTimer(){ if(timerId){ clearInterval(timerId); timerId=null; } }

    // ===== ìˆ˜í•™ ìœ í‹¸ =====
    function classifySide(a,b,c){
      const eps=1e-9;
      if(nearly(a,b,eps) && nearly(b,c,eps)) return 'equilateral';
      if(nearly(a,b,eps) || nearly(b,c,eps) || nearly(a,c,eps)) return 'isosceles';
      return 'scalene';
    }
    function classifyAngle(a,b,c){
      const s=[a,b,c].sort((x,y)=>x-y); const x=s[0], y=s[1], z=s[2];
      const lhs = x*x + y*y, rhs=z*z; const eps=1e-8;
      if(Math.abs(lhs-rhs)<=eps) return 'right';
      return lhs>rhs? 'acute':'obtuse';
    }
    function anglesDeg(a,b,c){
      // ë²•ì½”ì‚¬ì¸: AëŠ” a ëŒ€ë³€ì˜ ê°
      function ang(op, ad1, ad2){
        const v = (ad1*ad1 + ad2*ad2 - op*op) / (2*ad1*ad2);
        const clamped = Math.max(-1, Math.min(1, v));
        return Math.acos(clamped) * 180/Math.PI;
      }
      return [ang(a,b,c), ang(b,a,c), ang(c,a,b)];
    }
    function safeAngles(a,b,c){
      const type = classifyAngle(a,b,c);
      if(type==='right') return true;
      const angs = anglesDeg(a,b,c);
      return angs.every(A => (A < BANNED_MIN || A > BANNED_MAX));
    }

    // ===== ìƒì„±ê¸° (ëª¨ë‘ ì •ìˆ˜ ê¸¸ì´ë§Œ ì‚¬ìš©) =====
    function genEquilateral(){
      const L = randInt(4,12); // 4~12 cm
      return [L,L,L];
    }
    function genIsosceles(angle){
      for(let tries=0; tries<300; tries++){
        const a = randInt(5,20); // equal sides
        let cMin = 2, cMax = 2*a - 1;
        if(angle==='acute'){
          cMax = Math.min(cMax, Math.floor(Math.SQRT2*a) - 1);
        } else if(angle==='obtuse'){
          cMin = Math.max(cMin, Math.floor(Math.SQRT2*a) + 1);
        } else if(angle==='right'){
          continue; // ì •ìˆ˜ ë³€ìœ¼ë¡œëŠ” ë¶ˆê°€
        }
        if(cMin>cMax) continue;
        const c = randInt(cMin, cMax);
        const tri=[a,a,c];
        if(classifyAngle(...tri)!==angle) continue;
        if(!safeAngles(...tri)) continue;
        return tri;
      }
      return null;
    }
    function genScaleneRight(){
      const triples = [ [3,4,5], [5,12,13], [6,8,10], [7,24,25], [8,15,17], [9,12,15], [9,40,41], [12,16,20] ];
      const t = triples[Math.floor(Math.random()*triples.length)].slice();
      const k = randInt(1,2);
      const tri = t.map(x=>x*k);
      return tri;
    }
    function genScaleneAcute(){
      for(let tries=0; tries<500; tries++){
        let a = randInt(5,24), b = randInt(5,24), c = randInt(5,24);
        if(a===b || b===c || a===c) continue;
        if(!(a+b>c && a+c>b && b+c>a)) continue;
        if(classifyAngle(a,b,c)!=='acute') continue;
        if(!safeAngles(a,b,c)) continue;
        return [a,b,c];
      }
      return null;
    }
    function genScaleneObtuse(){
      for(let tries=0; tries<500; tries++){
        let a = randInt(6,28), b = randInt(6,28), c = randInt(6,28);
        if(a===b || b===c || a===c) continue;
        if(!(a+b>c && a+c>b && b+c>a)) continue;
        if(classifyAngle(a,b,c)!=='obtuse') continue;
        if(!safeAngles(a,b,c)) continue;
        return [a,b,c];
      }
      return null;
    }

    function genTrianglePair(){
      const anglePick = ['acute','right','obtuse'][randInt(0,2)];
      const feasible = anglePick==='acute' ? ['scalene','isosceles','equilateral']
                      : anglePick==='right' ? ['scalene']
                      : ['scalene','isosceles'];
      const sidePick = feasible[randInt(0,feasible.length-1)];

      for(let tries=0; tries<300; tries++){
        let tri=null;
        if(sidePick==='equilateral') tri = genEquilateral();
        else if(sidePick==='isosceles') tri = genIsosceles(anglePick);
        else if(sidePick==='scalene'){
          if(anglePick==='right') tri = genScaleneRight();
          else if(anglePick==='acute') tri = genScaleneAcute();
          else tri = genScaleneObtuse();
        }
        if(!tri) continue;
        const sType = classifySide(...tri);
        const aType = classifyAngle(...tri);
        if(sidePick==='equilateral' && aType!=='acute') continue;
        if(sType===sidePick && aType=== (sidePick==='equilateral' ? 'acute' : anglePick)){
          return {sides:tri, sideType:sType, angleType:aType};
        }
      }
      return {sides:genEquilateral(), sideType:'equilateral', angleType:'acute'};
    }

    // ===== ë Œë”ë§ (ì •í™• ê¸°í•˜ ìœ ì§€) =====
    function drawRightMarker(Cx,Cy, Ax,Ay, Bx,By){
      // Cì—ì„œ CA, CB ë°©í–¥ ë‹¨ìœ„ë²¡í„°
      const ux = (Ax-Cx), uy = (Ay-Cy); const ul = Math.hypot(ux,uy)||1; const u0x=ux/ul, u0y=uy/ul;
      const vx = (Bx-Cx), vy = (By-Cy); const vl = Math.hypot(vx,vy)||1; const v0x=vx/vl, v0y=vy/vl;
      const m = 14; // marker size
      const p1x = Cx + u0x*m, p1y = Cy + u0y*m;
      const cornerx = p1x + v0x*m, cornery = p1y + v0y*m;
      const p2x = Cx + v0x*m, p2y = Cy + v0y*m;
      ctx.beginPath();
      ctx.moveTo(p1x,p1y); ctx.lineTo(cornerx,cornery); ctx.lineTo(p2x,p2y);
      ctx.strokeStyle = '#9fd0ff'; ctx.lineWidth = 2; ctx.stroke();
    }

    function drawTriangleWithLabels(a,b,c){
      // ì •í™•í•œ ë¹„ìœ¨ ìœ ì§€ë¥¼ ìœ„í•´ ê°€ì¥ ê¸´ ë³€ì„ ë°‘ë³€(AB)ìœ¼ë¡œ, ë‚˜ë¨¸ì§€ëŠ” AC=b, BC=aë¡œ ë°°ì¹˜
      const sorted = [a,b,c].slice().sort((x,y)=>y-x); // ë‚´ë¦¼ì°¨ìˆœ
      const cLen = sorted[0]; // AB(ë°‘ë³€)
      const bLen = sorted[1]; // AC
      const aLen = sorted[2]; // BC

      // C ì¢Œí‘œ ê³„ì‚° (AB=cLen, AC=bLen, BC=aLen)
      let x = (bLen*bLen + cLen*cLen - aLen*aLen) / (2*cLen);
      let y = Math.sqrt(Math.max(bLen*bLen - x*x, 0));

      ctx.clearRect(0,0,canvas.width,canvas.height);
      const pad=34; const W=canvas.width-2*pad, H=canvas.height-2*pad;
      const maxDim = Math.max(cLen, y);
      const s = (Math.min(W,H)) / (maxDim*1.15 + 1); // ë“±ë¹„ ìŠ¤ì¼€ì¼(ì™œê³¡ ì—†ìŒ)

      const Ax = pad, Ay = canvas.height - pad;
      const Bx = pad + cLen*s, By = canvas.height - pad;
      const Cx = pad + x*s, Cy = canvas.height - pad - y*s;

      // ìœ¤ê³½ì„ 
      ctx.lineWidth = 3; ctx.strokeStyle = '#d9e6ff';
      ctx.beginPath(); ctx.moveTo(Ax,Ay); ctx.lineTo(Bx,By); ctx.lineTo(Cx,Cy); ctx.closePath(); ctx.stroke();

      // ê¸¸ì´ ë¼ë²¨ (ì •ìˆ˜ cm, AB/BC/CA í‘œê¸° ì—†ìŒ)
      ctx.fillStyle = '#c6d6ff'; ctx.font = '16px ui-monospace, Menlo, Consolas, monospace';
      function mid(x1,y1,x2,y2){ return [(x1+x2)/2, (y1+y2)/2]; }
      function write(txt, x,y){ ctx.save(); ctx.translate(x,y); ctx.fillText(txt,0,0); ctx.restore(); }

      const [mABx,mABy] = mid(Ax,Ay,Bx,By); write(`${cLen} cm`, mABx-16, mABy-8);
      const [mBCx,mBCy] = mid(Bx,By,Cx,Cy); write(`${aLen} cm`, mBCx+8, mBCy);
      const [mCAx,mCAy] = mid(Cx,Cy,Ax,Ay); write(`${bLen} cm`, mCAx-40, mCAy-6);

      // ì§ê° í‘œì‹œ (ê°€ì¥ ê¸´ ë³€ì˜ ë§ì€í¸ ê°)
      const aType = classifyAngle(a,b,c);
      if(aType==='right'){
        drawRightMarker(Cx,Cy, Ax,Ay, Bx,By);
      }
    }

    // ===== ê²Œì„ ë¡œì§ =====
    function nextProblem(){
      current = genTrianglePair();
      qIndex += 1;
      drawTriangleWithLabels(...current.sides);
      updateTopBar();
      feedback.textContent = `ë¬¸í•­ #${qIndex} â€” ë³€/ê°ì„ ì„ íƒí•˜ì—¬ ì œì¶œí•˜ì„¸ìš”.`;
      resetCards();
    }

    function onSubmit(){
      if(!started || locked) return;
      const sel = getSelections(); if(!sel) return;
      const truthSide = classifySide(...current.sides);
      const truthAngle = classifyAngle(...current.sides);
      const ok = (sel.side===truthSide) && (sel.angle===truthAngle);
      if(ok){
        correctCnt += 1; updateTopBar();
        feedback.innerHTML = 'âœ… <b>ì •ë‹µ!</b> ë‹¤ìŒ ë¬¸ì œë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤.';
        if(correctCnt >= TOTAL_QUESTIONS){
          stopTimer();
          feedback.innerHTML = `ğŸ‰ <b>ì™„ë£Œ!</b> ì´ ì†Œìš” ì‹œê°„: <b>${timerEl.textContent}</b>`;
          btnSubmit.disabled = true; btnReset.disabled = false; started=false; return;
        }
        nextProblem();
      } else {
        feedback.innerHTML = 'âŒ <b>ì˜¤ë‹µ</b> â€” 3ì´ˆê°„ ì ê¹ë‹ˆë‹¤. í‘œì‹œëœ ê¸¸ì´ë¥¼ ì˜ ë³´ì„¸ìš”.';
        resetCards();
        lockInputs(3000);
      }
    }

    function lockInputs(ms){
      locked = true;
      document.querySelectorAll('.opt').forEach(el=> el.classList.add('disabled'));
      btnSubmit.disabled = true;
      setTimeout(()=>{
        locked = false;
        document.querySelectorAll('.opt').forEach(el=> el.classList.remove('disabled'));
        btnSubmit.disabled = !getSelections();
        feedback.textContent = `ë¬¸í•­ #${qIndex} â€” ë‹¤ì‹œ ì‹œë„í•´ ë³´ì„¸ìš”.`;
      }, ms);
    }

    // ì¹´ë“œ í´ë¦­(ë°•ìŠ¤ ì „ì²´ í´ë¦­ & í•˜ì´ë¼ì´íŠ¸)
    function attachCardHandlers(){
      cardEls.forEach(el=>{
        el.addEventListener('click', ()=>{
          if(locked) return;
          const group = el.dataset.group; const value = el.dataset.value;
          // ê·¸ë£¹ ë‚´ ê¸°ì¡´ ì„ íƒ í•´ì œ
          document.querySelectorAll(`.opt[data-group="${group}"]`).forEach(x=> x.classList.remove('selected'));
          el.classList.add('selected');
          // ì‹¤ì œ ë¼ë””ì˜¤ ì²´í¬
          const input = el.querySelector('input'); input.checked = true;
          btnSubmit.disabled = !getSelections();
        });
      });
    }

    btnSubmit.addEventListener('click', onSubmit);

    btnStart.addEventListener('click', ()=>{
      started = true; qIndex=0; correctCnt=0; updateTopBar();
      btnStart.disabled = true; btnReset.disabled = true; feedback.textContent='ë¬¸ì œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦';
      resetCards();
      startTimer();
      nextProblem();
      btnSubmit.disabled = true;
    });

    btnReset.addEventListener('click', ()=>{
      stopTimer();
      timerEl.textContent = '00:00.00';
      started=false; qIndex=0; correctCnt=0; updateTopBar();
      feedback.textContent='ì‹œì‘ ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.';
      resetCards();
      btnStart.disabled = false; btnReset.disabled = true; btnSubmit.disabled = true;
      ctx.clearRect(0,0,canvas.width,canvas.height);
    });

    // ì´ˆê¸°
    attachCardHandlers();
    updateTopBar();
  </script>
</body>
</html>
